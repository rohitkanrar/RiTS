# Risk-inclusive Contextual Bandits for Early Phase Clinical Trials

This repository contains all codes used in the following paper

- Kanrar, R., Li, C., Ghodsi, Z., Gamalo, M. (2025+). Risk-inclusive Contextual Bandits for Early Phase Clinical Trials.

The method is named **R**isk-**i**nclusive **T**hompson **S**ampling (RiTS).

## Contents

- `/code/function`: contains all the supporting functions developed to conduct empirical experiments.
- `/code/real_data`: contains scripts to clean, visualize and analyze the real data utilized in the article.
- `/code/simulation`: contains scripts to conduct all simulation experiments described in both the main manuscript and the supplementary material. 
- `/code/visualization`: contains scripts that generates all figures except Figure 1 and Figure 2 in the main manuscript.
- `/metadata`: Additional .RData files created to run the simulation experiments conveniently. Files contain lists to specify hyper-parameters required in the simulation experiments.

### Contents of `/code/function`:
- `/code/function/main_function.R`: contains major functions to implement `Rand`, `TS` and `RiTS`.
- `/code/function/misc.R`: contains functions to clip propensities, obtain cumulative miscoverage, etc. 
- `/code/function/asymp_cs.R`: contains all functions to evaluate AsympCS.
- `/code/function/classical_ci.R`: contains functions to add t-test based confidence intervals to simulation outputs. 

### Contents of `/code/real_data`:
- `/code/real_data/replicated_application`: contains all functions to replicate methods on generated pseudo-outcomes.
- `/code/real_data/clean.R`: used to clean the data (not important as the real data is not shared.) 
- `/code/real_data/eda.R`: used to perform initial exploratory data analysis to select relevant covariates.
- `/code/real_data/baseline_lab.R`: supports the inclusion of some bio-markers in the safety model.

### Contents of `/code/simulation`:
- `/code/simulation/replicated_trial.R`: execute trial optimization steps with all methods for all choices of hyper-parameters. Multiple cores execute different cases in parallel.
- `/code/simulation/replicated_trial_evaluation.R`: adds AsympCSs and T-test based confidence intervals to the output generated by `/code/simulation/replicated_trial.R`.

### Contents of `/code/visualization`:
- `/code/visualization/appendix_viz.R`: generates all plots in the Web Appendix.
- `/code/visualization/main_viz.R`: generates all plots in the main text.
- `/code/visualization/viz_functions.R`: includes all functions to generate plots.
- `/code/visualization/response_letter.R`: used to generate a line plot included in the response letter.
- `/code/visualization/main_tab.R`: generates all tables included in the main text.
- `/code/visualization/appendix_tab.R`: generates all tables included in the Web Appendix.


## Initial Setup:

- Clone Github Repository:


```
git clone git@github.com:rohitkanrar/RiTS.git
cd RiTS
```
- Create additional folders to save output files:

```
mkdir output
```

- Install all required R packages:

```
source("code/r/requirements.R")
```

## A Test Case:

Here, we include steps to replicate the simulation experiment conducted in Section 3.

- Run trials:
```
source("code/simulation/replicated_trial.R")

```
- Visualize results by running the script `code/visualization/replicated_trial_figures.R`.
- Generate tables by running the script `-code/visualize/replicated_trial_tables.R`.


Please feel free to email at rohitk@iastate.edu with questions or to report any bugs. 
